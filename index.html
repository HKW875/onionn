<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Onionn â€” Lowest bulb onion prices in the market</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>

  <style>
    #submitOrderBtn {
    background-color: #27b02e;
    color: white; /* optional to keep text visible */
    }
    h1, h2, p {
    color: black;
    }
     h1, h2, label {
     font-family: 'Metropolis', sans-serif;
    }
    :root{
      --brand:#27b02e; 
      --brand-dark:#0f7c36;
      --ink:#27b02e;
      --muted:#6b7280;
      --bg:#9ec8e8;
      --card:#ffffff;
      --border:#1f2937;
      --accent:#f59e0b;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui;background:var(--bg);color:var(--ink);}
    header{padding:24px 12px 8px;text-align:center;}
    .logo{display:inline-flex;align-items:center;gap:12px;font-weight:800;font-size:clamp(24px,3.5vw,40px);color:var(--brand);font-family: 'Metropolis', sans-serif;}
    .logo .mark{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,var(--brand),#8A1422);display:inline-flex;align-items:center;justify-content:center;color:white;font-weight:900;}
    .container{max-width:980px;margin:0 auto;padding:0 12px 60px;}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 6px 24px rgba(0,0,0,0.04);margin-top:12px;}
    #map{width:100%;height:340px;border-radius:12px;border:1px solid var(--border);}
    h2{text-align:center;font-size:20px;}
    h1{text-align:center;font-size:15px;}
    label{display:block;margin:12px 0 6px;color:var(--muted);font-size:14px}
    input,select,textarea,button{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);font-size:16px;}
    textarea{resize:vertical;min-height:80px;}
    .btn{cursor:pointer;background:var(--brand);color:white;font-weight:700;margin-top:12px;border:none;}
    .btn.secondary{background:#111827;}
    .btn.ghost{background:transparent;color:var(--brand);border:1px solid var(--brand);}
    .summary{white-space:pre-wrap;background:#f8fafc;padding:12px;border-radius:10px;border:1px dashed var(--border);font-size:13px;}
    .success{color:var(--brand-dark);font-weight:600;margin-top:8px}
  </style>
</head>
<body>
  <header>
    <div class="logo"><div class="mark">ðŸ§…</div>Onionn</div>
  </header>
  <h2>ðŸ“±Order onions online ðŸšš Free same day delivery ðŸ’µ Save up to 50%! ðŸ“±Payment on delivery</h2>
  <h2>ðŸ“±Our current price: 50 Kes per kg ðŸ’µ Become a partner ðŸ’µ Earn points</h2>
  <h1>ðŸ§…Service available in Nairobi, Kitengela, Malindi, Kilifi, Mombasa</h1>
  <h1>ðŸ§…Current stock: ðŸ§…Nairobi:Sold out ðŸ§…Kitengela: Available ðŸ§…Malindi: Sold out ðŸ§…Kilifi: Sold out ðŸ§…Mombasa: Sold out</h1>

  <main class="container">
    <!-- Map -->
    <div class="card">
      <div id="map"></div>
    </div>

    <!-- Order Section -->
    <div id="orderArea" class="card">
      <div class="row">
        <div>
          <h2>Order onions (50 Ksh / Kg)</h2>

          <!-- Customer Details -->
          <label for="custName">Customer Name</label>
          <input id="custName" type="text" placeholder="Full Name"/>

          <label for="referredBy">Referred by (optional)</label>
          <input id="referredBy" style= "font-family: 'metropolis', sans serif;" type="text" placeholder="Name and number"/>

          <label for="custPhone">Phone Number</label>
          <input id="custPhone" type="tel" placeholder="07xx xxx xxx"/>

          <label for="custEmail">Email</label>
          <input id="custEmail" type="email" placeholder="example@email.com"/>

          <!-- Order Details -->
          <label for="qty">Quantity (Kg)</label>
          <input id="qty" type="number" min="1" value="1" />

          <label>Delivery location</label>
          <div style="display:flex;gap:8px;">
            <button id="useGeoBtn" class="btn">Use my geolocation</button>
            <button id="manualBtn" class="btn">Enter manually</button>
          </div>
          <div id="manualWrap" class="hidden">
            <label for="manualLocation">Manual delivery location</label>
            <input id="manualLocation" placeholder="Address or description"/>
          </div>

          <!-- Preferred Time -->
          <label for="deliveryTime">Preferred Delivery Time</label>
          <input id="deliveryTime" type="text" placeholder="e.g. 2 PM - 4 PM"/>

          <!-- Special Notes -->
          <label for="specialNotes">Special Delivery Notes / Instructions</label>
          <textarea id="specialNotes" placeholder="Any instructions for delivery?"></textarea>

          <!-- Payment -->
          <label>Payment method</label>
          <select id="paymentMode">
            <option value="mpesa">M-Pesa</option>
            <option value="pod">Payment on delivery</option>
          </select>

          <div id="mpesaOptions" class="hidden">
            <label for="mpesaAccount">Account / Business Name (optional)</label>
            <input id="mpesaAccount"/>
          </div>

          <!-- Copy to Email -->
          <label for="sendCopy">Send Copy of Order to Customer Email</label>
          <select id="sendCopy">
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>

          <div style="display:flex;gap:8px;">
            <button id="previewBtn" class="btn">Preview Order</button>
            <button id="partnerBtn" class="btn">Become a Partner</button>
          </div>
        </div>
        <div>
          <h2>Order summary</h2>
          <div id="summaryBox" class="summary" style= "color:black;" >No summary yet.</div>
          <button id="submitOrderBtn" class="btn secondary" style="margin-top:12px;">Submit Order</button>
        </div>
      </div>
    </div>

    <!-- User Data Safety (bottom of page) -->
    <div class="card center">
      <h2>User Data Safety</h2>
      <p class="muted"style="text-align:center; font-family:'Metropolis', sans-serif;">Click below to clear your account data.</p>
      <button id="logoutDataBtn" class="btn">Clear User Data</button>
      <div id="message" class="success hidden"></div>
    </div>
  </main>

  <!-- Partner modal -->
  <div id="partnerBackdrop" class="modal-backdrop" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.3);align-items:center;justify-content:center;">
    <div class="modal card" style="max-width:500px;">
      <h2>Become a farmer or Seller Partner</h2>
      <label for="partner_name">Full name</label>
      <input id="partner_name" type="text" />
      <label for="referred_by">Referred by (optional)</label>
      <input id="referred_by" type="text" />
      <label for="partner_email">Email</label>
      <input id="partner_email" type="email" />
      <label for="partner_phone">Phone</label>
      <input id="partner_phone" type="tel" />
      <label for="partner_location">Location</label>
      <input id="partner_location" />
      <div style="display:flex;gap:8px;margin-top:12px;">
        <button id="partnerSubmitBtn" class="btn">Send Inquiry</button>
        <button id="partnerCancelBtn" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const PRICE_PER_KG = 50;
    const SELLER_PHONE = '+254708253594';
    const SELLER_EMAIL = 'wambuguhkw@gmail.com';
    const VENDOR_COUNT = 6;

    // Clear user data
    document.getElementById("logoutDataBtn").addEventListener("click", () => {
      localStorage.clear();
      document.getElementById("message").textContent = "âœ… Data cleared.";
      document.getElementById("message").classList.remove("hidden");
    });

    // Map + vendors
    let userGeo=null, map, userMarker, vendorLayer;
    function initMap(){
      map=L.map("map").setView([-1.286389,36.817223],13);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map);
      vendorLayer=L.layerGroup().addTo(map);
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
          userGeo={lat:pos.coords.latitude,lng:pos.coords.longitude};
          map.setView([userGeo.lat,userGeo.lng],13);
          userMarker=L.circleMarker([userGeo.lat,userGeo.lng],{radius:8,color:"#0f7c36",fill:"#0f7c36"}).addTo(map).bindPopup("You are here");
          placeVendorsNearUser();
        },()=>placeVendorsNearUser());
      } else placeVendorsNearUser();
    }
    function placeVendorsNearUser(){
      vendorLayer.clearLayers();
      const center=userGeo?[userGeo.lat,userGeo.lng]:[-1.286389,36.817223];
      for(let i=0;i<VENDOR_COUNT;i++){
        const lat=center[0]+(Math.random()*0.03-0.015);
        const lng=center[1]+(Math.random()*0.03-0.015);
        const dist=distanceBetween(center[0],center[1],lat,lng);
        const eta=(dist/30)*60;
        L.marker([lat,lng]).addTo(vendorLayer).bindPopup(`Vendor ${i+1}<br>Est. ${Math.round(eta)} min<br>${dist.toFixed(2)} km`);
      }
    }
    function distanceBetween(a,b,c,d){const R=6371;const dLat=(c-a)*Math.PI/180;const dLon=(d-b)*Math.PI/180;const x=Math.sin(dLat/2)**2+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(dLon/2)**2;return R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));}

    // Delivery + payment logic
    const manualWrap=document.getElementById("manualWrap");
    const manualLocation=document.getElementById("manualLocation");
    let manualLoc="";
    document.getElementById("useGeoBtn").addEventListener("click",()=>{if(userGeo){manualLoc="";manualWrap.classList.add("hidden");alert("Delivery set to geolocation");}});
    document.getElementById("manualBtn").addEventListener("click",()=>manualWrap.classList.remove("hidden"));
    manualLocation.addEventListener("input",()=>manualLoc=manualLocation.value.trim());

    const paymentMode=document.getElementById("paymentMode");
    const mpesaOptions=document.getElementById("mpesaOptions");
    paymentMode.addEventListener("change",()=>mpesaOptions.classList.toggle("hidden",paymentMode.value!=="mpesa"));

    // Build summary
    function buildSummary(){
      const qty=Number(document.getElementById("qty").value)||0;
      const total=qty*PRICE_PER_KG;
      const now=new Date().toLocaleString();
      const name=document.getElementById("custName").value.trim();
      const referredBy=document.getElementById("referredBy").value.trim();
      const phone=document.getElementById("custPhone").value.trim();
      const email=document.getElementById("custEmail").value.trim();
      const deliveryTime=document.getElementById("deliveryTime").value.trim();
      const notes=document.getElementById("specialNotes").value.trim();
      const sendCopy=document.getElementById("sendCopy").value==="yes"?"Yes":"No";
      const payment=paymentMode.value==="mpesa"?"M-Pesa":"Payment on Delivery";
      const account=document.getElementById("mpesaAccount").value.trim();
      let delivery=manualLoc|| (userGeo?`${userGeo.lat.toFixed(6)},${userGeo.lng.toFixed(6)}`:"Not set");

      return `Order time: ${now}
Customer: ${name}
Phone: ${phone}
Email: ${email}
Quantity: ${qty} Kg
Total: ${total} Ksh
Preferred delivery time: ${deliveryTime}
Special delivery Notes: ${notes}
Delivery location: ${delivery}
Payment method: ${payment}
Account: ${account}
Send Copy to Customer Email: ${sendCopy}`;
    }
    document.getElementById("previewBtn").addEventListener("click",()=>{document.getElementById("summaryBox").textContent=buildSummary();});
    document.getElementById("submitOrderBtn").addEventListener("click",()=>sendOrderViaExternalLink(buildSummary()));

    function sendOrderViaExternalLink(summary){
      if(/Mobi|Android|iPhone/i.test(navigator.userAgent)){window.location.href=`sms:${SELLER_PHONE}?body=${encodeURIComponent(summary)}`;}
      else{window.location.href=`mailto:${SELLER_EMAIL}?subject=Onionn Order&body=${encodeURIComponent(summary)}`;}
    }

    // Partner modal
    const partnerBackdrop=document.getElementById("partnerBackdrop");
    document.getElementById("partnerBtn").addEventListener("click",()=>{partnerBackdrop.style.display="flex";});
    document.getElementById("partnerCancelBtn").addEventListener("click",()=>{partnerBackdrop.style.display="none";});
    document.getElementById("partnerSubmitBtn").addEventListener("click",()=>{alert("Partner inquiry sent.");partnerBackdrop.style.display="none";});

    window.addEventListener("load",initMap);
  </script>
</body>
</html>
